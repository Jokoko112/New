<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agenda Apuesta ⚽</title>
  <style>
    body { background: #0f172a; color: #f1f5f9; font-family: "Poppins", sans-serif; margin:0; padding:0; text-align:center; }
    header { background:#1e293b; padding:1rem; box-shadow:0 2px 10px rgba(0,0,0,0.4); }
    h1 { color: #38bdf8; margin:0; }
    .filters { margin:1rem auto; max-width:500px; display:flex; gap:0.5rem; justify-content:center; flex-wrap:wrap; }
    input { padding:0.5rem; border-radius:6px; border:1px solid #ccc; flex:1; min-width:150px; }
    .country { font-weight:bold; color:#facc15; margin-top:1rem; font-size:1.2rem; text-align:left; }
    .league { color:#94a3b8; font-weight:600; margin-top:0.3rem; text-align:left; }
    .match { background:#1e293b; margin:0.5rem 0; padding:0.5rem 1rem; border-radius:8px; display:flex; justify-content:space-between; align-items:center; }
    .hora { color:#22c55e; font-weight:bold; }
    .container { max-width:600px; margin:0 auto; padding:1rem; text-align:left; }
    footer { text-align:center; font-size:0.85rem; color:#666; margin-top:2rem; }
  </style>
</head>
<body>
<header>
  <h1>Agenda Apuesta ⚽</h1>
  <p>Partidos de hoy - Hora real de cada liga (24h)</p>
</header>

<div class="filters">
  <input type="text" id="search" placeholder="Buscar por país, liga o equipo...">
</div>

<div class="container" id="agenda">Cargando partidos...</div>

<footer>
  Datos por <a href="https://www.api-football.com/" target="_blank">API-Football</a> — legal y sin transmisiones.
</footer>

<script>
const API_KEY = "58587099b74e80acd927232e2fbf71df";
const agenda = document.getElementById("agenda");
const searchInput = document.getElementById("search");

// Lista manual por si API falla
const listaManual = [
  { pais: "Argentina 🇦🇷", liga: "Primera División", local: "River Plate", visita: "Boca Juniors", hora: "20:10" },
  { pais: "Argentina 🇦🇷", liga: "Primera Nacional", local: "San Martín (T)", visita: "Ferro", hora: "19:30" },
  { pais: "Brasil 🇧🇷", liga: "Serie A", local: "Flamengo", visita: "Palmeiras", hora: "21:00" },
  { pais: "España 🇪🇸", liga: "LaLiga", local: "Real Madrid", visita: "Barcelona", hora: "17:00" }
];

// Mapas de países y banderas
const paisesESP = {
  "Argentina":"Argentina","Brazil":"Brasil","Spain":"España","Turkey":"Turquía","Italy":"Italia",
  "France":"Francia","England":"Inglaterra","Germany":"Alemania","Portugal":"Portugal","Mexico":"México",
  "Ecuador":"Ecuador","Uruguay":"Uruguay","Chile":"Chile"
};
const banderas = {
  "Argentina":"🇦🇷","Brasil":"🇧🇷","España":"🇪🇸","Turquía":"🇹🇷","Italia":"🇮🇹",
  "Francia":"🇫🇷","Inglaterra":"🏴","Alemania":"🇩🇪","Portugal":"🇵🇹","México":"🇲🇽",
  "Ecuador":"🇪🇨","Uruguay":"🇺🇾","Chile":"🇨🇱"
};

// Ligas permitidas (solo apostables A y B)
const ligasPermitidas = [
  "Primera División","Primera Nacional","Serie A","Serie B",
  "LaLiga","Segunda División","Premier League","Championship",
  "Serie A Italia","Serie B Italia","Ligue 1","Ligue 2"
];

// Traer partidos API
async function cargarPartidos() {
  try {
    const res = await fetch(`https://v3.football.api-sports.io/fixtures?date=${new Date().toISOString().split('T')[0]}`, {
      headers: { "x-apisports-key": API_KEY }
    });
    const data = await res.json();
    if (data.response && data.response.length>0) mostrarPartidosAPI(filtrarHoy(partidosApostables(data.response)));
    else mostrarManual();
  } catch(err) { console.log(err); mostrarManual(); }
}

// Filtrar solo partidos hoy
function filtrarHoy(partidos) {
  const hoy = new Date();
  return partidos.filter(p=>{
    const partido = new Date(p.fixture.date);
    return partido.getFullYear()===hoy.getFullYear() &&
           partido.getMonth()===hoy.getMonth() &&
           partido.getDate()===hoy.getDate();
  });
}

// Filtrar solo ligas apostables
function partidosApostables(partidos) {
  return partidos.filter(p=>ligasPermitidas.includes(p.league.name));
}

// Mostrar partidos API
function mostrarPartidosAPI(partidos) {
  const lista = partidos.map(p=>{
    const paisEsp = paisesESP[p.league.country] || p.league.country;
    return {
      pais: paisEsp + " " + (banderas[paisEsp]||"🌍"),
      liga: p.league.name,
      local: p.teams.home.name,
      visita: p.teams.away.name,
      hora: formatearHoraReal(p.fixture.date, p.league.timezone)
    }
  });
  renderizar(ordenarPorPaisLiga(lista));
}

// Mostrar lista manual
function mostrarManual() { renderizar(ordenarPorPaisLiga(listaManual)); }

// Formatear hora real de la liga en 24h
function formatearHoraReal(fechaUTC, timezone) {
  const partido = new Date(fechaUTC);
  try {
    return partido.toLocaleTimeString("es-AR", {hour12:false,hour:"2-digit",minute:"2-digit", timeZone: timezone});
  } catch {
    // fallback si timezone falla
    return partido.toLocaleTimeString("es-AR",{hour12:false,hour:"2-digit",minute:"2-digit"});
  }
}

// Ordenar por país y liga
function ordenarPorPaisLiga(lista) {
  const grupos = {};
  lista.forEach(p=>{
    if(!grupos[p.pais]) grupos[p.pais]={};
    if(!grupos[p.pais][p.liga]) grupos[p.pais][p.liga]=[];
    grupos[p.pais][p.liga].push(p);
  });
  return grupos;
}

// Renderizar
function renderizar(grupos) {
  const q = searchInput.value.toLowerCase();
  agenda.innerHTML="";
  for(const pais in grupos){
    let paisMatches=false;
    let htmlPais=`<div class="country">${pais}</div>`;
    for(const liga in grupos[pais]){
      const partidos = grupos[pais][liga].filter(p=>(`${p.local} ${p.visita} ${p.liga} ${p.pais}`.toLowerCase().includes(q)));
      if(partidos.length===0) continue;
      paisMatches=true;
      htmlPais+=`<div class="league">${liga}</div>`;
      partidos.forEach(m=>{
        htmlPais+=`<div class="match"><span>${m.local} vs ${m.visita}</span><span class="hora">${m.hora}</span></div>`;
      });
    }
    if(paisMatches) agenda.innerHTML+=htmlPais;
  }
  if(!agenda.innerHTML) agenda.innerHTML="<p>No hay partidos para mostrar.</p>";
}

// Buscador
searchInput.addEventListener("input",()=>cargarPartidos());

cargarPartidos();
</script>
</body>
</html>
